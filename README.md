# SmartCalculator

calculator – פרויקט בפייתון
מגיש : אביב לוי 212228258

הסבר כללי
המחשבון שלי בנוי משלושה אובייקטים שאחראים לפתירה:
•	operationsHelper – אובייקט שאחראי על פעולות העזר אשר קשורות לתהליך הפתירה (לדוגמא האם מינוס הוא סימן או אופרטור), מכיל את הפעולות שאפשר לבצע במחשבון
•	validator  - אובייקט אשר אחראי על בדיקת תקינות הקלט של הביטוי שהכניס המשתמש. נותן את האישור לשליחת הביטוי לפתירה. נעזר ב  operationsHelper  במהלך הבדיקה. בנוסף משתמש בפעולות של מודל formatting שמתאים את הביטוי לכך שהפותר יוכל לפתור. 
•	solver – אובייקט אשר אחראי על פתירת הביטוי החשבוני , נעזר ב operationsHelper במהלך פתירת הביטוי.

אופטור
מחשבון זה הוא גנרי לחלוטין , כלומר ניתן באמצעות הפעלת פעולה פשוטה להוסיף אופרטור חדש למחשבון זה. 
במחשבון זה אופטור מוגדר על ידי ארבעה פרמטרים:
•	סימן
•	פעולה
•	משקל
•	ומיקומו (אופטור אונארי יכול לבוא מימין או משמאל לאופרנד (2~ , !3) אחרת הוא אופרטור אמצעי) LEFT,MIDDLE,RIGHT





הפותר
דרך הפעולה של פתירת ביטוי חשבוני במתמטיקה היא חיפוש הביטוי החזק ביותר (בעל המשקל הגדול ביותר) , פתירתו והדבקתו בביטוי. חוזרים על התהליך עד שמקבלים את הפתרון של החישוב לדוגמא:
5+!4*2
קודם נפתור את העצרת , כי הוא בעל המשקל הגדול ביותר 4! =24
נדביק בביטוי
2*24+5
לאחר מכן נפתור את הכפל , 2*24 = 48
נדביק 
48+5
לבסוף נפתור את החיבור 48+5 = 53
נדביק
53
וקיבלנו את תוצאת הביטוי.

את פתירת הביטוי אבצע באמצעות רקורסיה. הפונקציה תחלק את הביטוי לתתי ביטויים לפי חוזק הביטוי כמו בדוגמא שכתבתי ותחשב את הביטויים את תוצאתו בחזור.
כלומר ב"הלוך" הרקורסיה קוראת לעצמה עם תתי הביטויים עד שתת הביטוי הוא אופרנד, ומחזירה את ערכו , ב"חזור" מהרקורסיה נקבל תוצאת הביטוי ששלחנו בהלוך , ונשתמש בתוצאת הביטוי על מנת לחשב את הביטוי החדש שאותו נחשב.
מכאן נובע כי חישוב הביטוי קורה בחזרה מהרקורסיה, משמע סדר הפעולות בקריאה לרקורסיה בהלוך הוא הפוך מסדר הפעולות הרגיל כפי שתיארתי. בהלוך במקום לבחור באופרטור המקסימלי השמאלי ביותר אבחר באופרטור הימני החלש ביותר כך שבחזרה מהרקורסיה הביטוי הראשון שיחושב יהיה החזק ביותר כי הוא האחרון שנבחר.



דוגמא:  הליכה קדימה ברקורסיה
5+!4*2
2*4!    +    5
			                  2     *      4!  
						    4	
חזרה מרקורסיה:
						   4
				        24	         *            2
				5	+ 	48
					53


על מנת לממש את הפתרון הזה יש לכתוב פונקציה אשר מוצאת את האופטור החלש ביותר.
יש לציין כי אופטור חלש אשר נמצא בתוך סוגריים בהכרח יותר חזק מאופרטור חזק שנמצא מחוץ לסוגריים לכן לסוגריים יהיה משקל נוסף בעל הערך החזק ביותר (extra)
הפונקציה תעבור על הביטוי ותשמור במשתנה את האופרטור החלש ביותר, הערך ההתחלתי יהיה ערך אינסופי. ככל שניכנס עמוק בתוך הסוגריים נגדיל את משקלים יותר וככל שנצא נקטין בהתאם. בכל אופטור נשווה בינו לבין המינימלי ואם הוא קטן יותר הוא יהפוך להיות המינימלי ביותר. במתמטיקה יש עדיפות לאופטור השמאלי יותר לדוגמא 
5*5/2 קודם נבצע את החילוק, לכן בגלל שהפונקציה פותרת בחזרה מהרקורסיה נבחר את הימני יותר.
מכיוון שברצף של אופרטורים שמאליים יש עדיפות דווקא לשמאלי יותר (מתמטיקה לימני אך כאן נעבוד הפוך) יש לטפל כך במקרה מיוחד. דוגמא 5~~ במתמטיקה נעדיף את הימני יותר ונדביק למשוואה ונמשיך כך עד שיתקבל תשובה , לכן אצלנו נעדיף את השמאלי יותר מה שמנוגד לפעולה לכן נעשה מקרה מיוחד.

דבר נוסף אשר יש לשים לב אליו במהלך הפתירה והבדיקת תקינות הוא האם מינוס הוא סימן או אופרטור. את בדיקה זו נבצע על ידי בדיקה משמאל וימין לאופרטור.
במציאת האופטור החלש ביותר נבדיל בין מינוס של סימן ושל אופרטור , ובהתאם לכך נבחר בהתאם את האופטור החלש ביותר.



תקינות קלט

בהתחלה נבדוק את המקרים שבהם הביטוי אינה תקין בתוכן שלו ללא קשר לסדר פעולות:
•	בדיקה האם המחרוזת ריקה
•	האם התווים הם תקינים ויכולים להיות בביטוי חשבוני
•	בדיקה האם הנקודות בביטוי באמת מייצגות מספר לא שלם
לאחר מכן נבדוק את תקינות הסוגריים בביטוי ,הבדיקה בנויה משני תנאים:
•	לכל פותח יש סוגר
•	אין סוגריים מיותרות
אחרי זה נעבור לבדיקה של סדר הפעולות בביטוי החשבוני:
•	בדיקה האם לאופטור חסר אופרנדים ולהפך
•	בדיקה האם שרשור האופרטורים תקין


בבדיקת האופרטורים נדבוק האם לכל אופטור יש משני צדדיו איברים תקינים לפי מיקומו ביחס לאופרנדים (LEFT,RIGHT,MIDDLE)
בבדיקת השרשור נבדוק לכל סוג אופטור האם השרשור (אם יש תקין):
•	אם אופרטור שמאלי , אסור שמשמאלו יהיה אופטור שמאלי חזק יותר
•	אם אופרטור ימני , אסור שימינו יהיה אופטור ימני חזק יותר
•	אם אופטור אמצעי אסור שמשמאל יהיה אופטור שהוא לא ימני, ומשמאלו אופרטור שהוא לא ימני

התקינות של השרשורים של שמאליים וימניים נובעת מכך שלפי סדר פעולות יהיה עדיפות לבצע אופטור מסויים לפי משקלו אך האופרנד אשר עליו לחשב יכיל אופרטור ולכן לא יהיה ניתן לחשב את הביטוי. לדוגמא אופטור שמאלי # אשר יותר חזק מ~
ביטוי כזה : 5~# אינו חוקי , מכיוון שלפי סדר פעולות יש לבחור קודם את # , ולחשב ולהדביק בחזרה בביטוי , אך אין אפשרות לחשב את הפעולה על "5~" מכיוון שאינו אופרנד.

שגיאות
כאשר הביטוי עובר תקינות קלט אינו אומר עדיין שהוא תקין לגמרי. במהלך הפתירה יש אפשרות שהחישוב לא יהיה חוקי מבחינה מתמטית ויש לעצור את התוכנית ולטפל בשגיאה שנוצרה. השגיאות אשר בהם אני מטפל במהלך הפתירה הם:
•	חילוק באפס
•	עצרת למספר שלילי
•	עצרת למספר לא שלם
•	כאשר אין מקום לאחסן את התוצאה במשתנה מסוג float (OVERFLOW)
•	כאשר הוכנס ביטוי בעל המון אופרטורים ולכן יהיו יותר מדי קריאות לרקורסיה
•	אין תמיכה במספרים מרוכבים (כאשר יש לבצע פעולות כמו > < תהיינה קריסה)


